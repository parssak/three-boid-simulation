var _parcelHelpers = require("@parcel/transformer-js/lib/esmodule-helpers.js");
_parcelHelpers.defineInteropFlag(exports);
_parcelHelpers.export(exports, "scene", function () {
  return scene;
});
_parcelHelpers.export(exports, "Entity", function () {
  return Entity;
});
var _three = require('three');
var _threeOrbitControls = require('three-orbit-controls');
var _threeOrbitControlsDefault = _parcelHelpers.interopDefault(_threeOrbitControls);
var _uuid = require('uuid');
const OrbitControls = _threeOrbitControlsDefault.default(_three);
// Handles Controls and Camera
class CameraController {
  constructor(renderer) {
    // -- Camera
    // Set up Camera
    this.camera = new _three.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.01, 20000);
    this.renderer = renderer;
    // Set up Controls
    this.controls = new OrbitControls(this.camera, this.renderer.domElement);
    // Optional Settings
    this.controls.autoRotate = false;
    this.controls.enableDamping = true;
    this.controls.dampingFactor = 0.39;
    this.camera.position.z = 200;
    this.controls.update();
    // Recalibrates on resize
    window.addEventListener('resize', () => this._Resize());
  }
  Update() {
    this.controls.update();
  }
  _Resize() {
    this.camera.aspect = this.container.clientWidth / this.container.clientHeight;
    this.camera.updateProjectionMatrix();
    this.renderer.setSize(this.container.clientWidth, this.container.clientHeight);
    this.renderer.setPixelRatio(window.devicePixelRatio);
  }
}
class Scene {
  constructor() {
    this.entities = [];
    // Renderer
    this.renderer = new _three.WebGLRenderer({
      antialias: true
    });
    this.renderer.setSize(window.innerWidth, window.innerHeight);
    // Container
    this.container = document.getElementById('container');
    this.container.appendChild(this.renderer.domElement);
    // Camera Controller
    this.cameraController = new CameraController(this.renderer);
    // Scene
    this.scene = new _three.Scene();
    const ambientLight = new _three.AmbientLight(0x041f60);
    ambientLight.intensity = 0.3;
    this.scene.add(ambientLight);
    this.scene.fog = new _three.Fog(0x041f60, 3000, 20000);
    // How Update works
    this.renderer.setAnimationLoop(time => this.Update(time));
  }
  /**
  * Adds a new mesh to the scene.
  * @param {THREE.Mesh} mesh New Mesh to add to scene
  */
  Add(entity) {
    if (entity.mesh) {
      this.scene.add(entity.mesh);
      this.entities.push(entity);
    } else if (entity.group) {
      this.scene.add(entity.group);
      this.entities.push(entity);
    }
  }
  Update(time) {
    this.entities.forEach(entity => !entity.inGroup && entity.Update(time));
    this.cameraController.Update();
    this.renderer.render(this.scene, this.cameraController.camera);
  }
}
const scene = new Scene();
class Entity {
  constructor(inGroup = false) {
    if (this.constructor == Entity) throw new Error("Abstract classes can't be instantiated.");
    this.id = _uuid.v4();
    this.scene = scene;
    this.inGroup = inGroup;
    this.Start();
  }
  /*Use this to define the mesh of the Entity*/
  BuildMesh() {
    if (this.constructor == Entity) throw new Error("Abstract classes can't be instantiated.");
  }
  /*Called once on initialization*/
  Start() {
    this.BuildMesh();
    this.scene.Add(this);
  }
  /*Called every frame*/
  Update(time) {}
}
